install.packages("installr");
library(installr)
updateR()
85+890+15+10
95/1000
install.packages(c("arules", "arulesViz", "Boruta", "Ecfun", "gender", "GGally", "gplots", "jsonlite", "multcomp", "plotmo", "prodlim", "RColorBrewer", "RcppArmadillo", "RCurl", "reshape2", "rFerns", "ROAuth", "rpart.plot", "rrcov", "seriation", "shiny", "VGAM"))
convert_to_minute <- function(arrival) {
arrive_time <- as.POSIXct(arrival, '%Y %m %d %H %M', tz = 'UTC')
age <- as.integer(difftime(arrive_time, reference_time, units = 'mins', tz = 'UTC'))
return(age)
}
reference_time <- as.POSIXct('2014 1 1 0 0', '%Y %m %d %H %M', tz = 'UTC')
convert_to_minute('2532 01 22 09 07')
convert_to_chardate <- function(arrive_int) {
char_date <- format(reference_time + arrive_int * 60, format = '%Y %m %d %H %M', tz = 'UTC')
return(char_date)
}
convert_to_chardate(9000000)
convert_to_chardate(17500000)
convert_to_chardate(175000000)
10000/24
setwd('C:/Users/Ivan.Liuyanfeng/Desktop/Data_Mining_Work_Space/FICO/Helping-Santas-Helpers')
gc(); rm(list=ls()); source('R code/Functions.R'); source('R code/c_Functions.r')
load('data/toys.RData')
NUM_ELVES <- 900
myelves <- create_elves(NUM_ELVES)
head(toys)
toy_break1 <- 600; toy_break2 <- 2880
toys <- data.matrix(transform(toys, Size = 0))
toys[which(toys[,'Duration']>toy_break2),'Size'] <- 3 # overwork
toys[which(toys[,'Duration']<=toy_break2),'Size'] <- 2 # 48 hour
toys[which(toys[,'Duration']<=toy_break1),'Size'] <- 1 # 10 hour
head(toys)
myToys <- toys
cat(format(Sys.time(),format = '%Y-%m-%d %H:%M:%S'))
outcomes <- matrix(0, nrow = nrow(myToys), ncol = 5,
dimnames = list(NULL, c('ToyId', 'ElfId', 'StartTime', 'Duration', 'current_rating')))
next_elf <- myelves[which.min(myelves[,'next_available_time']),]
next_elf
c_elf_id <- myelves[next_elf, 'elf_id']
c_elf_start_time <- myelves[next_elf, 'next_available_time']
c_elf_rating <- myelves[next_elf, 'current_rating']
c_elf_id
next_elf
c_elf_id <- myelves[next_elf, 'elf_id']
c_elf_id
c_elf_id <- myelves[next_elf, 1]
c_elf_id
dim(c_elf_id)
dim(myelves)
next_elf <- myelves[which.min(myelves[,3]),]
next_elf
c_elf_id <- next_elf[,1]
c_elf_id
c_elf_id <- next_elf[1]
c_elf_id
c_elf_start_time <- next_elf[3]
c_elf_rating <- next_elf[2]
c_elf_rating
if(c_elf_rating == 4.0){
mytoys <- myToys[which(myToys[,'size']==3),]
}else if(c_elf_rating > 3){
mytoys <- myToys[which(myToys[,'size']==2),]
}else{
mytoys <- myToys[which(myToys[,'size']==1),]
}
head(mytoys)
head(myToys)
dim(myToys)
if(c_elf_rating == 4.0){
mytoys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
mytoys <- myToys[which(myToys[,'Size']==2),]
}else{
mytoys <- myToys[which(myToys[,'Size']==1),]
}
dim(myToys)
dim(mytoys)
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
dim(myToys)
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
head(myToys)
toys <- data.matrix(transform(toys, r_duration = 0))
toys <- data.matrix(transform(toys, start_time = 0))
toys <- data.matrix(transform(toys, finish = 0))
toys <- data.matrix(transform(toys, rate_f = 0))
toys <- data.matrix(transform(toys, refresh = 0))
head(toys)
myToys <- toys
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
dim(mytoys)
dim(myToys)
rm(mytoys)
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
head(myToys)
myToys[,'start_time'] <- max(c_elf_start_time, myToys[, 'Arrival_time'])
head(myToys)
c_elf_start_time
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
c_elf_start_time
head(myToys)
myToys[,'rate_f'] <- updateProductivity(myToys[,'rate_f'], work_duration, c_elf_rating)
myToys[,'rate_f'] <- updateProductivity(myToys[,'rate_f'], myToys[c_toy_id,'r_duration'], c_elf_rating)
myToys[,'rate_f'] <- updateProductivity(myToys[,'rate_f'], myToys[,'r_duration'], c_elf_rating)
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:nrow(myToys)){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys <- myToys[which(myToys[,'Size']==3),]
dim(myToys)
myToys <- toys
myToys <- myToys[which(myToys[,'Size']==3),]
dim(myToys)
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:nrow(myToys)){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
head(myToys)
c_toy_id <- mytoys[order(myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish'])][1,1]
c_toy_id <- myToys[order(myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish'])][1,1]
c_toy_id <- myToys[order(myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish'])]
head(c_toy_id)
c_toy_id <- myToys[order(myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),]
head(c_toy_id)
c_toy_id <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,1]
c_toy_id
c_elf_start_time <- myToys[c_toy_id, 'start_time']
c_elf_start_time
c_toy <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,]
c_toy
c_toy_id <- c_toy[1]
c_elf_start_time <- c_toy[, 'start_time']
work_duration <- c_toy[,'r_duration']
c_elf_start_time <- c_toy['start_time']
work_duration <- c_toy['r_duration']
c_elf_start_time
work_duration
c_toy
c_elf_start_time <- c_toy[6]
work_duration <- c_toy[5]
work_duration
c_elf_start_time
next_elf
myelves[c_elf_id, 'next_available_time'] <- myToys[c_toy_id,'refresh']
myelves[c_elf_id, 'current_rating'] <- myToys[c_toy_id,'rate_f']
myelves
head(myelves)
outcomes[current_toy,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
i <- 1
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
outcomes
head(outcomes)
for(i in 1:5){
next_elf <- myelves[which.min(myelves[,3]),]
c_elf_id <- next_elf[1]
c_elf_start_time <- next_elf[3]
c_elf_rating <- next_elf[2]
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:nrow(myToys)){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
c_toy <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,]
c_toy_id <- c_toy[1]
c_elf_start_time <- c_toy[6]
work_duration <- c_toy[5]
myelves[c_elf_id, 'next_available_time'] <- myToys[c_toy_id,'refresh']
myelves[c_elf_id, 'current_rating'] <- myToys[c_toy_id,'rate_f']
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
if(current_toy %% 100000 == 0) cat('\nCompleted', current_toy/1000000, 'mil toys, makespan', c_elf_start_time, 'minutes',
format(Sys.time(),format = '%Y-%m-%d %H:%M:%S'))
}
cat('\nCompleted 10 mil toys at', convert_to_chardate(c_elf_start_time))
return(outcomes)
}
for(i in 1:5){
next_elf <- myelves[which.min(myelves[,3]),]
c_elf_id <- next_elf[1]
c_elf_start_time <- next_elf[3]
c_elf_rating <- next_elf[2]
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:nrow(myToys)){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
c_toy <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,]
c_toy_id <- c_toy[1]
c_elf_start_time <- c_toy[6]
work_duration <- c_toy[5]
myelves[c_elf_id, 'next_available_time'] <- myToys[c_toy_id,'refresh']
myelves[c_elf_id, 'current_rating'] <- myToys[c_toy_id,'rate_f']
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
if(i %% 100000 == 0) cat('\nCompleted', i/1000000, 'mil toys, makespan', c_elf_start_time, 'minutes',
format(Sys.time(),format = '%Y-%m-%d %H:%M:%S'))
}
myToys[1, 'Arrival_time']
head(myToys)
myToys<-toys
for(i in 1:5){
next_elf <- myelves[which.min(myelves[,3]),]
c_elf_id <- next_elf[1]
c_elf_start_time <- next_elf[3]
c_elf_rating <- next_elf[2]
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:100){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
c_toy <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,]
c_toy_id <- c_toy[1]
c_elf_start_time <- c_toy[6]
work_duration <- c_toy[5]
myelves[c_elf_id, 'next_available_time'] <- myToys[c_toy_id,'refresh']
myelves[c_elf_id, 'current_rating'] <- myToys[c_toy_id,'rate_f']
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
if(i %% 100000 == 0) cat('\nCompleted', i/1000000, 'mil toys, makespan', c_elf_start_time, 'minutes',
format(Sys.time(),format = '%Y-%m-%d %H:%M:%S'))
}
outcomes
head(outcomes, 100)
for(i in 1:5){
next_elf <- myelves[which.min(myelves[,3]),]
c_elf_id <- next_elf[1]
c_elf_start_time <- next_elf[3]
c_elf_rating <- next_elf[2]
if(c_elf_rating == 4.0){
myToys <- myToys[which(myToys[,'Size']==3),]
}else if(c_elf_rating > 3){
myToys <- myToys[which(myToys[,'Size']==2),]
}else{
myToys <- myToys[which(myToys[,'Size']==1),]
}
myToys[,'r_duration'] <- as.integer(ceiling(myToys[,'Duration']/c_elf_rating))
for(j in 1:20){
myToys[j,'start_time'] <- max(c_elf_start_time, myToys[j, 'Arrival_time']) #
myToys[j,'rate_f'] <- updateProductivity(myToys[j,'rate_f'], myToys[j,'r_duration'], c_elf_rating)
myToys[j,'refresh'] <- updateNextAvailableMinute(myToys[j,'start_time'], myToys[j,'r_duration'])
}
myToys[,'finish'] <- myToys[,'r_duration']+ myToys[,'start_time']
c_toy <- myToys[order(-myToys[,'rate_f'],myToys[,'refresh'],myToys[,'finish']),][1,]
c_toy_id <- c_toy[1]
c_elf_start_time <- c_toy[6]
work_duration <- c_toy[5]
myelves[c_elf_id, 'next_available_time'] <- myToys[c_toy_id,'refresh']
myelves[c_elf_id, 'current_rating'] <- myToys[c_toy_id,'rate_f']
outcomes[i,] <- c(c_toy_id, c_elf_id, c_elf_start_time, work_duration, c_elf_rating)
myToys <- myToys[-c_toy_id,]
if(i %% 100000 == 0) cat('\nCompleted', i/1000000, 'mil toys, makespan', c_elf_start_time, 'minutes',
format(Sys.time(),format = '%Y-%m-%d %H:%M:%S'))
}
head(outcomes, 100)
head(outcomes, 10)
